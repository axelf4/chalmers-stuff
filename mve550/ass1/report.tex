\documentclass{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[swedish]{babel}
\usepackage{amsmath, amssymb, mathtools}
\usepackage{tikz}
\usepackage{enumitem}
\usepackage{siunitx}
\usepackage{ifthen}

\usetikzlibrary{arrows, decorations.markings, calc, shapes.geometric}

\DeclareMathOperator\rowSums{rowSums}

\begin{document}

\section{Question 1}
\subsection{Part (a)}
\subsection{Part (d)}
Compute $\pi(Y \mid X)$ by numerical integration.
Throwing $\lambda$ into the mix and integrating it out:
\begin{align*}
	\pi(Y \mid X) &= \int_\Lambda \pi(Y, \lambda \mid X) \, d\lambda \\
	&= \int_\Lambda \pi(Y \mid X) \pi(\lambda \mid X) \, d\lambda
\end{align*}
where $\Lambda = \mathbb R^+$ and
we have used $\pi(Y, \lambda \mid X) = \pi(Y \mid X, \lambda) \pi(\lambda \mid X)$,
and the fact that the prediction given the parameter is independent of the data.
Using Bayes' theorem and the law of total probability
$$ \pi(\lambda \mid X) = \frac{\pi(X \mid \lambda) \pi(\lambda)}{\int_\lambda \pi(X \mid \lambda) \pi(\lambda) \, d\lambda} $$

\section{Question \num{3.52} in Dobrow.}
With the rule variation that you have to roll the exact number to reach
the final square.

\begin{center}
	\def\ladderwidth{1.5mm}
	\def\ladderstep{1.5mm}
	\begin{tikzpicture}[
			state/.style={ draw, regular polygon, regular polygon sides=4, fill=gray!15 },
			every edge/.style={ draw, ->,>=stealth', auto, },
			chute/.style={ top color=gray!50, bottom color=gray!50,
			middle color=gray!10, draw=gray!50!black, line cap=round,
			draw opacity=0.3, fill opacity=0.5,
			line join=round,line width=1pt,},
			ladder/.style={decorate,decoration={
				markings,
				mark=between positions {1/#1/2} and {-1/#1/2} step {1/#1} with {
					\draw[draw=gray, draw opacity=0.5,
					line cap=round, line join=round, line width=2pt,]
					(0,-\ladderwidth) -- (0,\ladderwidth)
					(\ladderstep,-\ladderwidth) -- (-\ladderstep,-\ladderwidth)
					(\ladderstep,\ladderwidth) -- (-\ladderstep,\ladderwidth);
					},
					},
					},
					ladder auto/.style={
						to path={
							let \p1=($(\tikztostart) - (\tikztotarget)$), \n1={veclen(\x1,\y1)} in
							\pgfextra{
								\pgfmathsetmacro{\bars}{int(\n1/\ladderstep/2)+1}
								\pgfinterruptpath
								\draw[ladder=\bars] (\tikztostart) -- (\tikztotarget);
								\endpgfinterruptpath
								}
								},
								},
								chute auto/.style={
									to path={
										let
										\p1=([xshift=\ladderwidth]\tikztostart),
										\p2=([xshift=-\ladderwidth]\tikztostart),
										\p3=([xshift=\ladderwidth]\tikztotarget),
										\p4=([xshift=-\ladderwidth]\tikztotarget),
										\p5=($(\p1)!.4!(\p3)$),
										\p6=($(\p2)!.4!(\p4)$)
										in
										\pgfextra{
											\pgfinterruptpath
											\path[chute]
											(\p1) sin (\p5) cos (\p3) --
											(\p4) sin (\p6) cos (\p2) -- cycle;
											\endpgfinterruptpath
											}
											},
											},
											]
											\foreach \x in {0,...,2}
											\foreach \y in {0,...,2} {
												\pgfmathtruncatemacro\label{1 + \x + 3 * \y}
												\ifthenelse{1 = \y}{\def\xp{4 - 2 * \x}}{\def\xp{2 * \x}}
												\ifthenelse{\NOT 1 = \x}{
													\node[state] (\label) at (\xp, 2 * \y) {\label};
													}{
														\node[state, draw opacity=0.3, fill opacity=0.3] (\label) at (\xp, 2 * \y) {\label};
														}
														}

		\draw[chute auto] (3) to (5) (4) to (8);
		\draw[ladder auto] (2) to (7);

		\draw (1) edge[bend right] node[below] {\tt 2/4} (3);
		\draw (1) edge node[below] {\tt 1/4} (4);
		\draw (1) edge[bend left=70] node{\tt 1/4} (7);

		\draw (3) edge[loop right] node{\tt 1/4} (3);
		\draw (3) edge[bend right=70] node[right] {\tt 1/4} (4);
		\draw (3) edge[bend left] node{\tt 1/4} (6);
		\draw (3) edge[bend right] node[above] {\tt 1/4} (7);

		\draw (4) edge[loop above] node{\tt 1/4} (4);
		\draw (4) edge node{\tt 1/4} (3);
		\draw (4) edge[bend left] node[below left] {\tt 1/4} (6);
		\draw (4) edge[bend left] node{\tt 1/4} (7);

		\draw (6) edge[loop below] node{\tt 1/4} (6);
		\draw (6) edge node[below] {\tt 1/4} (4);
		\draw (6) edge[bend left] node{\tt 1/4} (7);
		\draw (6) edge node{\tt 1/4} (9);

		\draw (7) edge[loop above] node{\tt 2/4} (7);
		\draw (7) edge[bend left] node{\tt 1/4} (9);
		\draw (7) edge[bend left] node{\tt 1/4} (4);

		\draw (9) edge[loop right] node{\tt 1} (9);
	\end{tikzpicture}
\end{center}

\begin{enumerate}[label=(\alph*)]
	\item Find the expected length of the game.

		The transition matrix is
		\begin{equation}
			P \coloneqq \bordermatrix{~ & 1 & 3 & 4 & 6 & 7 & 9 \cr
			1 & 2/4 & 1/4 & 0 & 0 & 1/4 & 0 \cr
			3 & 0 & 1/4 & 1/4 & 1/4 & 1/4 & 0 \cr
			4 & 0 & 1/4 & 1/4 & 1/4 & 1/4 & 0 \cr
			6 & 0 & 0 & 1/4 & 1/4 & 1/4 & 1/4 \cr
			7 & 0 & 0 & 1/4 & 0 & 2/4 & 1/4 \cr
			9 & 0 & 0 & 0 & 0 & 0 & 1 \cr
			}
		\end{equation}
		This gives
		$$ F \coloneqq (I - Q)^{-1} = \left(\begin{pmatrix}
			1 & 0 & 0 & 0 & 0 \\
			0 & 1 & 0 & 0 & 0 \\
			0 & 0 & 1 & 0 & 0 \\
			0 & 0 & 0 & 1 & 0 \\
			0 & 0 & 0 & 0 & 1 \\
		\end{pmatrix} - \begin{pmatrix}
			2/4 & 1/4 & 0 & 0 & 1/4 \\
			0 & 1/4 & 1/4 & 1/4 & 1/4 \\
			0 & 1/4 & 1/4 & 1/4 & 1/4 \\
			0 & 0 & 1/4 & 1/4 & 1/4 \\
			0 & 0 & 1/4 & 0 & 2/4 \\
		\end{pmatrix}\right)^{-1}
		= \begin{pmatrix}
			\cdots \\
		\end{pmatrix}
		$$
		and
		$$ \rowSums(F) = \bordermatrix{
			~ & ~ \cr
			1 & 9 \cr
			3 & 8 \cr
			4 & 8 \cr
			6 & 6 \cr
			7 & 6 \cr
			} $$
			Which gives the expexted number of steps starting from each state
			to first hit $9$.
			Thus the answer is $9$.

		\item Assume that the player is on square 6.
			Find the probability that they will find themselves on square 3 before finishing the game.

			Modify $P$ to make $3$ an absorbing state and repeat the above.
\end{enumerate}

\end{document}
